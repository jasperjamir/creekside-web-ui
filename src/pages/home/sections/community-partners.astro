---
import { COLORS, ASSETS_BASE_URL } from '../../../constants';

interface Partner {
  name: string;
  /** Sanity image object (asset.url) or legacy string URL/path */
  image?: { asset?: { url: string }; alt?: string } | string;
}

interface Props {
  heading?: string;
  assetsBaseUrl?: string;
  partners?: readonly Partner[];
}

const { heading = '', assetsBaseUrl = ASSETS_BASE_URL, partners = [] } = Astro.props;
---

<section class="py-16 border-y" style={{ backgroundColor: `${COLORS.blue.light}4D`, borderColor: COLORS.blue.light }}>
  <div class="container mx-auto px-4 lg:px-8">
    <div class="text-center mb-10">
      <h2 class="text-2xl font-bold mb-2" style={{ color: COLORS.blue.navy }}>{heading}</h2>
      <div class="h-1 w-16 mx-auto rounded-full" style={{ backgroundColor: COLORS.green }}></div>
    </div>

    <div class="flex flex-wrap justify-center items-center gap-12">
      {partners.filter((p) => p?.image && (typeof p.image === 'string' ? p.image : p.image?.asset?.url)).map((partner) => {
        const img = partner.image!;
        const src = typeof img === 'string'
          ? (img.startsWith('http') ? img : (assetsBaseUrl ? `${assetsBaseUrl.replace(/\/$/, '')}/${img.replace(/^\//, '')}` : img.startsWith('/') ? img : `/${img}`))
          : (img as { asset?: { url: string }; alt?: string }).asset!.url;
        const alt = partner.name;
        return (
          <div class="group flex items-center justify-center min-h-[80px] min-w-[120px]">
            <img
              src={src}
              alt={alt}
              class="max-h-16 w-auto max-w-[180px] object-contain opacity-80 grayscale group-hover:opacity-100 group-hover:grayscale-0 transition-all duration-500"
              loading="lazy"
              referrerpolicy="no-referrer"
              width="160"
              height="80"
            />
          </div>
        );
      })}
    </div>
  </div>
</section>
